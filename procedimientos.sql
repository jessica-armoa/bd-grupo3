GO
USE grupo3
GO

/************************************/
/*          PROCEDIMIENTOS          */
/************************************/

/************ Tabla MARCAS ***********/
GO
CREATE PROCEDURE Crear_Marcas @DESCRIPCION_MARCA VARCHAR(255)
AS
BEGIN
  INSERT INTO MARCAS (MARCA)
  VALUES(@DESCRIPCION_MARCA);
END;
GO

GO
CREATE PROCEDURE Eliminar_Marcas @ID INT
AS
BEGIN
  DELETE FROM MARCAS WHERE MARCA_ID = @ID;
END
GO

GO
CREATE PROCEDURE Modificar_Marcas
  @ID INT,
  @DESCRIPCION_MARCA VARCHAR(255)
AS
BEGIN
  UPDATE MARCAS SET MARCA = @DESCRIPCION_MARCA WHERE MARCA_ID = @ID
END;
GO

/************ Tabla TIPOS ***********/
GO
CREATE PROCEDURE Crear_Tipos
  @DESCRIPCION_TIPO VARCHAR(255)
AS
BEGIN
  INSERT INTO TIPOS(TIPO)
  VALUES(@DESCRIPCION_TIPO);
END;
GO

GO
CREATE PROCEDURE Eliminar_Tipos @ID INT
AS
BEGIN
  DELETE FROM TIPOS WHERE TIPO_ID = @ID;
END
GO

GO
CREATE PROCEDURE Modificar_Tipos
  @ID INT,
  @DESCRIPCION_TIPO VARCHAR(255)
AS
BEGIN
  UPDATE TIPOS SET TIPO = @DESCRIPCION_TIPO WHERE TIPO_ID = @ID
END;
GO

/************ Tabla DEPOSITOS ***********/
GO
CREATE PROCEDURE Crear_Depositos @DESCRIPCION_TIPODEP VARCHAR(255)
AS
BEGIN
  INSERT INTO DEPOSITOS (TIPO_DEPOSITO)
  VALUES(@DESCRIPCION_TIPODEP);
END;

GO
CREATE PROCEDURE Eliminar_Depositos @ID INT
AS
BEGIN
  DELETE FROM DEPOSITOS WHERE DEPOSITO_ID = @ID;
END
GO

GO
CREATE PROCEDURE Modificar_Depositos
  @ID INT,
  @DESCRIPCION_DEP VARCHAR(255)
AS
BEGIN
  UPDATE DEPOSITOS SET TIPO_DEPOSITO = @DESCRIPCION_DEP WHERE DEPOSITO_ID = @ID
END;
GO

/************ Tabla PRODUCTOS ***********/
GO
CREATE PROCEDURE Crear_Productos
  @marca_id INT,
  @tipo_id INT,
  @descripcion VARCHAR(255),
  @es_servicio BIT,
  @precio_unitario NUMERIC,
  @iva DECIMAL(4,3)
AS
BEGIN
  INSERT INTO PRODUCTOS (marca_id, tipo_id, descripcion, es_servicio, precio_unitario, iva)
  VALUES(@marca_id, @tipo_id, @descripcion, @es_servicio, @precio_unitario, @iva);
END;

GO
CREATE PROCEDURE Eliminar_Productos @ID INT
AS
BEGIN
  DELETE FROM PRODUCTOS WHERE producto_id = @ID;
END;

GO
CREATE PROCEDURE Modificar_Productos
  @ID INT,
  @marca_id INT,
  @tipo_id INT,
  @descripcion VARCHAR(255),
  @es_servicio BIT,
  @precio_unitario NUMERIC,
  @iva DECIMAL(4,3)
AS
BEGIN
  UPDATE productos
    SET marca_id = @marca_id, tipo_id = @tipo_id, descripcion = @descripcion, es_servicio = @es_servicio, precio_unitario = @precio_unitario, iva = @iva
    WHERE producto_id = @ID;
END;

/************ Tabla STOCKS ***********/
GO
CREATE PROCEDURE Crear_Stocks
  @deposito_id INT,
  @producto_id INT,
  @cantidad_producto INT
AS
BEGIN
  INSERT INTO STOCKS (deposito_id, producto_id, cantidad_producto)
  VALUES(@deposito_id, @producto_id, @cantidad_producto);
END;

GO
CREATE PROCEDURE Eliminar_Stocks @ID INT
AS
BEGIN
  DELETE FROM STOCKS WHERE Stock_id = @ID;
END;

GO
CREATE PROCEDURE Modificar_Stocks
  @ID INT,
  @deposito_id INT,
  @producto_id INT,
  @cantidad_producto INT
AS
BEGIN
  UPDATE STOCKS
    SET deposito_id = @deposito_id, producto_id = @producto_id, cantidad_producto = @cantidad_producto
    WHERE Stock_id = @ID;
END;

/************ Tabla PERSONAS ***********/
GO
CREATE PROCEDURE Crear_Personas @NOMBRE VARCHAR(255),@DIRECCION VARCHAR(255),@TELEFONO VARCHAR(255), @CORREO_ELECTRONICO VARCHAR(255)
AS
BEGIN
  INSERT INTO PERSONAS(NOMBRE,DIRECCION,TELEFONO, CORREO_ELECTRONICO)
  VALUES(@NOMBRE,@DIRECCION,@TELEFONO,@CORREO_ELECTRONICO);
END;
GO

GO
CREATE PROCEDURE Eliminar_Personas @ID INT
AS
BEGIN
  DELETE FROM PERSONAS WHERE PERSONA_ID = @ID;
END
GO

GO
CREATE PROCEDURE Modificar_Personas
  @ID INT,
  @NOMBRE VARCHAR(255),
  @DIRECCION VARCHAR(255),
  @TELEFONO VARCHAR(255),
  @CORREO_ELECTRONICO VARCHAR(255)
AS
BEGIN
  UPDATE PERSONAS SET NOMBRE = @NOMBRE, DIRECCION = @DIRECCION,TELEFONO = @TELEFONO, CORREO_ELECTRONICO = @CORREO_ELECTRONICO WHERE PERSONA_ID = @ID
END;
GO


/************ Tabla CLIENTES ***********/
GO
CREATE PROCEDURE Crear_Clientes @ID int,@ID_PERSONA int, @RUC varchar(20)
AS
BEGIN
  INSERT INTO CLIENTES(CLIENTE_ID, PERSONA_ID, RUC)
  VALUES(@ID, @ID_PERSONA, @RUC);
END;
GO

GO
CREATE PROCEDURE Eliminar_Clientes @ID INT
AS
BEGIN
  DELETE FROM CLIENTES WHERE CLIENTE_ID = @ID;
END
GO

GO
CREATE PROCEDURE Modificar_Clientes
  @ID INT,
  @ID_PERSONA INT,
  @RUC VARCHAR(20)
AS
BEGIN
  UPDATE CLIENTES SET PERSONA_ID = @ID_PERSONA,RUC = @RUC WHERE CLIENTE_ID = @ID
END;
GO

/************ Tabla EMPLEADOS ***********/
GO
CREATE PROCEDURE Crear_Empleados @ID_PERSONA INT, @CARGO VARCHAR(255)
AS
BEGIN
  INSERT INTO EMPLEADOS (PERSONA_ID, CARGO)
  VALUES (@ID_PERSONA, @CARGO);
END;
GO

GO
CREATE PROCEDURE Eliminar_Empleados @ID INT
AS
BEGIN
  DELETE FROM EMPLEADOS WHERE EMPLEADO_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_Empleados
  @ID INT,
  @ID_PERSONA INT,
  @CARGO VARCHAR(255)
AS
BEGIN
  UPDATE EMPLEADOS SET PERSONA_ID = @ID_PERSONA, CARGO = @CARGO WHERE EMPLEADO_ID = @ID;
END;
GO

/************ Tabla TRANSFERENCIAS ***********/
GO
CREATE PROCEDURE Crear_Transferencias
  @DEPOSITO_ORIGEN_ID INT,
  @DEPOSITO_DESTINO_ID INT,
  @ENCARGADO_ID INT,
  @AUTORIZANTE_ID INT,
  @FECHA DATETIME
AS
BEGIN
  INSERT INTO TRANSFERENCIAS (DEPOSITO_ORIGEN_ID, DEPOSITO_DESTINO_ID, ENCARGADO_ID, AUTORIZANTE_ID, FECHA)
  VALUES (@DEPOSITO_ORIGEN_ID, @DEPOSITO_DESTINO_ID, @ENCARGADO_ID, @AUTORIZANTE_ID, @FECHA);
END;
GO

GO
CREATE PROCEDURE Eliminar_Transferencias @ID INT
AS
BEGIN
  DELETE FROM TRANSFERENCIAS WHERE TRANFERENCIA_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_Transferencias
  @ID INT,
  @DEPOSITO_ORIGEN_ID INT,
  @DEPOSITO_DESTINO_ID INT,
  @ENCARGADO_ID INT,
  @AUTORIZANTE_ID INT,
  @FECHA DATETIME
AS
BEGIN
  UPDATE TRANSFERENCIAS
  SET DEPOSITO_ORIGEN_ID = @DEPOSITO_ORIGEN_ID,
      DEPOSITO_DESTINO_ID = @DEPOSITO_DESTINO_ID,
      ENCARGADO_ID = @ENCARGADO_ID,
      AUTORIZANTE_ID = @AUTORIZANTE_ID,
      FECHA = @FECHA
  WHERE TRANFERENCIA_ID = @ID;
END;
GO


/************ Tabla DETALLES_TRANSFERENCIAS ***********/
GO
CREATE PROCEDURE Crear_DetalleTransferencias @TRANFERENCIA_ID INT, @PRODUCTO_ID INT, @CANTIDAD INT
AS
BEGIN
  INSERT INTO DETALLES_TRANSFERENCIAS (TRANFERENCIA_ID, PRODUCTO_ID, CANTIDAD)
  VALUES (@TRANFERENCIA_ID, @PRODUCTO_ID, @CANTIDAD);
END;
GO

GO
CREATE PROCEDURE Eliminar_DetalleTransferencias @ID INT
AS
BEGIN
  DELETE FROM DETALLES_TRANSFERENCIAS WHERE DETALLE_TRANSFERENCIA_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_DetalleTransferencias
  @ID INT,
  @TRANFERENCIA_ID INT,
  @PRODUCTO_ID INT,
  @CANTIDAD INT
AS
BEGIN
  UPDATE DETALLES_TRANSFERENCIAS
  SET TRANFERENCIA_ID = @TRANFERENCIA_ID,
      PRODUCTO_ID = @PRODUCTO_ID,
      CANTIDAD = @CANTIDAD
  WHERE DETALLE_TRANSFERENCIA_ID = @ID;
END;
GO

/************ Tabla SERVICIOS_REALIZADOS ***********/
GO
CREATE PROCEDURE Crear_ServiciosRealizados @CLIENTE_ID INT, @FECHA DATETIME, @DESCRIPCION VARCHAR(255), @FACTURADO BIT
AS
BEGIN
  INSERT INTO SERVICIOS_REALIZADOS (CLIENTE_ID, FECHA, DESCRIPCION, FACTURADO)
  VALUES (@CLIENTE_ID, @FECHA, @DESCRIPCION, @FACTURADO);
END;
GO

GO
CREATE PROCEDURE Eliminar_ServiciosRealizados @ID INT
AS
BEGIN
  DELETE FROM SERVICIOS_REALIZADOS WHERE SERVICIO_REALIZADO_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_ServiciosRealizados
  @ID INT,
  @CLIENTE_ID INT,
  @FECHA DATETIME,
  @DESCRIPCION VARCHAR(255),
  @FACTURADO BIT
AS
BEGIN
  UPDATE SERVICIOS_REALIZADOS
  SET CLIENTE_ID = @CLIENTE_ID,
      FECHA = @FECHA,
      DESCRIPCION = @DESCRIPCION,
      FACTURADO = @FACTURADO
  WHERE SERVICIO_REALIZADO_ID = @ID;
END;
GO

/************ Tabla DETALLES_PRODUCTOS_UTILIZADOS ***********/
GO
CREATE PROCEDURE Crear_DetallesProductosUtilizados
  @PRODUCTO_ID INT,
  @SERVICIO_REALIZADO_ID INT,
  @CANTIDAD INT,
  @PRECIO_UNITARIO NUMERIC,
  @IVA DECIMAL(4,3)
AS
BEGIN
  INSERT INTO DETALLES_PRODUCTOS_UTILIZADOS (PRODUCTO_ID, SERVICIO_REALIZADO_ID, CANTIDAD, PRECIO_UNITARIO, IVA)
  VALUES (@PRODUCTO_ID, @SERVICIO_REALIZADO_ID, @CANTIDAD, @PRECIO_UNITARIO, @IVA);
END;
GO

GO
CREATE PROCEDURE Eliminar_DetallesProductosUtilizados @ID INT
AS
BEGIN
  DELETE FROM DETALLES_PRODUCTOS_UTILIZADOS WHERE DETALLE_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_DetallesProductosUtilizados
  @ID INT,
  @PRODUCTO_ID INT,
  @SERVICIO_REALIZADO_ID INT,
  @CANTIDAD INT,
  @PRECIO_UNITARIO NUMERIC,
  @IVA DECIMAL(4,3)
AS
BEGIN
  UPDATE DETALLES_PRODUCTOS_UTILIZADOS
  SET PRODUCTO_ID = @PRODUCTO_ID,
      SERVICIO_REALIZADO_ID = @SERVICIO_REALIZADO_ID,
      CANTIDAD = @CANTIDAD,
      PRECIO_UNITARIO = @PRECIO_UNITARIO,
      IVA = @IVA
  WHERE DETALLE_ID = @ID;
END;
GO


/************ Tabla FACTURAS ***********/
GO
CREATE PROCEDURE Crear_Facturas @CLIENTE_ID INT, @SERVICIO_REALIZADO_ID INT, @FECHA DATETIME, @TOTAL INT, @TIPO CHAR(1)
AS
BEGIN
  INSERT INTO FACTURAS (CLIENTE_ID, SERVICIO_REALIZADO_ID, FECHA, TOTAL, TIPO)
  VALUES (@CLIENTE_ID, @SERVICIO_REALIZADO_ID, @FECHA, @TOTAL, @TIPO);
END;
GO

GO
CREATE PROCEDURE Eliminar_Facturas @ID INT
AS
BEGIN
  DELETE FROM FACTURAS WHERE FACTURA_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_Facturas
  @ID INT,
  @CLIENTE_ID INT,
  @SERVICIO_REALIZADO_ID INT,
  @FECHA DATETIME,
  @TOTAL INT,
  @TIPO CHAR(1)
AS
BEGIN
  UPDATE FACTURAS
  SET CLIENTE_ID = @CLIENTE_ID,
      SERVICIO_REALIZADO_ID = @SERVICIO_REALIZADO_ID,
      FECHA = @FECHA,
      TOTAL = @TOTAL,
      TIPO = @TIPO
  WHERE FACTURA_ID = @ID;
END;
GO


/************ Tabla DETALLES_FACTURAS ***********/
GO
CREATE PROCEDURE Crear_DetallesFacturas @FACTURA_ID INT, @PRODUCTO_ID INT, @CANTIDAD INT, @PRECIO_UNITARIO NUMERIC, @IVA DECIMAL(4,3)
AS
BEGIN
  INSERT INTO DETALLES_FACTURAS (FACTURA_ID, PRODUCTO_ID, CANTIDAD, PRECIO_UNITARIO, IVA)
  VALUES (@FACTURA_ID, @PRODUCTO_ID, @CANTIDAD, @PRECIO_UNITARIO, @IVA);
END;
GO

GO
CREATE PROCEDURE Eliminar_DetallesFacturas @ID INT
AS
BEGIN
  DELETE FROM DETALLES_FACTURAS WHERE DETALLE_FACTURA_ID = @ID;
END;
GO

GO
CREATE PROCEDURE Modificar_DetallesFacturas
  @ID INT,
  @FACTURA_ID INT,
  @PRODUCTO_ID INT,
  @CANTIDAD INT,
  @PRECIO_UNITARIO NUMERIC,
  @IVA DECIMAL(4,3)
AS
BEGIN
  UPDATE DETALLES_FACTURAS
  SET FACTURA_ID = @FACTURA_ID,
      PRODUCTO_ID = @PRODUCTO_ID,
      CANTIDAD = @CANTIDAD,
      PRECIO_UNITARIO = @PRECIO_UNITARIO,
      IVA = @IVA
  WHERE DETALLE_FACTURA_ID = @ID;
END;
GO



/************************************/
/*              PRUEBAS             */
/************************************/


-----+  prueba de procedimientos para una tabla  +-----

-- Crear una marca
EXEC Crear_Marcas 'Marca Prueba';

-- Obtener el ID de la marca que acabamos de crear
DECLARE @IDMarca INT;
SELECT @IDMarca = MARCA_ID
FROM MARCAS
WHERE MARCA = 'Marca Prueba';

-- Modificar la marca
EXEC Modificar_Marcas @IDMarca, 'Nueva Marca Prueba';

-- Eliminar la marca
EXEC Eliminar_Marcas @IDMarca;

-- Verificaciones
SELECT *
FROM MARCAS
WHERE MARCA = 'Marca Prueba';
SELECT *
FROM MARCAS
WHERE MARCA_ID = @IDMarca;

-----+  fin prueba de procedimientos para una tabla  +-----


-----+  prueba de procedimientos para tablas de tipo cabecera-detalle  +-----

-- Crear productos de prueba
EXEC Crear_Productos 1, 1, 'Producto Prueba 1', 0, 20000, 0.10;
EXEC Crear_Productos 1, 1, 'Producto Prueba 2', 0, 25000, 0.10;

-- Crear stocks de prueba
EXEC Crear_Stocks 1, 1, 20; -- Producto Prueba 1, Depósito 1
EXEC Crear_Stocks 2, 1, 3; -- Producto Prueba 1, Depósito 2
EXEC Crear_Stocks 1, 2, 15; -- Producto Prueba 2, Depósito 1
EXEC Crear_Stocks 2, 2, 4; -- Producto Prueba 2, Depósito 2

-----+  fin prueba de procedimientos para tablas de tipo cabecera-detalle  +-----